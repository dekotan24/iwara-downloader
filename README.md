# IwaraDownloader

iwara.tv から動画をダウンロードするためのWindows用デスクトップアプリケーションです。

## 特徴

- **チャンネル購読機能** - お気に入りのユーザーを登録して新着動画を自動チェック
- **一括ダウンロード** - 購読チャンネルの動画をまとめてダウンロード
- **単発ダウンロード** - 動画URLを指定して個別にダウンロード
- **ダウンロードキュー管理** - 複数動画の同時ダウンロード（最大3並列）
- **自動新着チェック** - 指定間隔で新着動画を自動検出
- **タスクトレイ常駐** - バックグラウンドで動作
- **トースト通知** - ダウンロード完了や新着検出を通知
- **チャンネル別保存先** - ユーザーごとにカスタム保存フォルダを設定可能
- **設定・購読リストのエクスポート/インポート** - バックアップや移行に対応

## 動作環境

- Windows 10/11 (64bit)
- [.NET 8.0 Desktop Runtime](https://dotnet.microsoft.com/download/dotnet/8.0)
- Python 3.8以上（3.10.0で動作確認済）

## インストール

### 1. アプリケーションのダウンロード

[Releases](https://github.com/dekotan24/iwara-downloader/releases) から最新版をダウンロードして任意のフォルダに展開してください。

### 2. Python環境の準備

Python 3.8以上がインストールされている必要があります。

- [Python公式サイト](https://www.python.org/downloads/) からダウンロード
- または [Python Embeddable Package](https://www.python.org/downloads/) を使用

### 3. 初回セットアップ

1. `IwaraDownloader.exe` を起動
2. 「環境セットアップ」ボタンをクリック
3. Pythonのパスを入力（例: `C:\Python311\python.exe`）※エラーになったら再度試行してください。
4. セットアップが完了するまで待機（cloudscraperが自動インストールされます）

### 4. ログイン

1. 「ログイン」ボタンをクリック
2. iwara.tv のメールアドレスとパスワードを入力
3. ログイン完了後、すべての機能が利用可能になります

## 使い方

### チャンネルを購読する

1. URL入力欄にユーザー名またはプロフィールURL（`https://www.iwara.tv/profile/username`）を入力
2. Enterキーを押すか「貼り付けて追加」ボタンをクリック
3. 左側のチャンネルリストに追加されます

### 動画をダウンロードする

**チャンネルの動画をダウンロード:**
1. 左側のチャンネルリストからチャンネルを選択
2. 右側の動画リストでダウンロードしたい動画を右クリック
3. 「ダウンロード」を選択

**単発でダウンロード:**
1. URL入力欄に動画URL（`https://www.iwara.tv/video/xxxxx`）を入力
2. Enterキーを押すと自動的にダウンロードキューに追加されます

### 新着チェック

- 「今すぐチェック」ボタンで手動チェック
- 設定で自動チェック間隔を指定可能（30分〜24時間）
- 新着検出時に自動ダウンロードするオプションあり

### 設定

「設定」ボタンから以下の項目を変更できます：

- ダウンロード先フォルダ
- デフォルト画質（Source / 540p / 360p）
- 同時ダウンロード数（1〜3）※大きい数字を設定するとサーバに負荷がかかるので1か2を推奨
- リトライ回数
- 自動チェック間隔
- 新着検出時の自動ダウンロード
- トースト通知のON/OFF
- 起動時の最小化
- 閉じるボタンでトレイに最小化

### 詳細設定（レート制限）

多数のチャンネルを購読している場合や、大量の動画をダウンロードする場合は、「詳細設定」タブでレート制限を調整できます：

- **APIリクエスト間隔** - 動画情報取得等のリクエスト間隔（デフォルト: 1000ms）
- **ダウンロード間隔** - 動画DL完了後の待機時間（デフォルト: 3000ms）
- **チャンネル巡回間隔** - 次のチャンネルチェックまでの待機（デフォルト: 5000ms）
- **ページ取得間隔** - 動画一覧のページング時（デフォルト: 500ms）
- **429/403エラー時の待機** - エラー時のバックオフ時間
- **エクスポネンシャルバックオフ** - 連続エラー時に待機時間を段階的に増加

※ 値が小さすぎるとサーバーからアクセス制限（403/429エラー）を受ける可能性があります。

## ファイル構成

```
IwaraDownloader/
├── IwaraDownloader.exe    # メインアプリケーション
├── iwara_helper.py        # Python APIヘルパー
├── iwara_setup.bat        # Python環境セットアップ用
└── その他DLL等
```

## データ保存場所

アプリケーションデータは以下に保存されます：

```
%APPDATA%\IwaraDownloader\
├── settings.json         # アプリ設定
├── data.db               # 購読・動画情報（SQLite）
├── token.txt             # ログイントークン
├── python_path.txt       # Pythonパス設定
└── error.log             # エラーログ
```

## トラブルシューティング

### セットアップに失敗する

- Pythonのパスが正しいか確認してください
- インターネット接続を確認してください（cloudscraperのインストールに必要）
- ウイルス対策ソフトがブロックしていないか確認してください

### ログインに失敗する

- メールアドレスとパスワードが正しいか確認してください
- iwara.tv のサイトに直接ログインできるか確認してください
- 環境セットアップが完了しているか確認してください

### ダウンロードに失敗する

- ログイン状態を確認してください
- 動画が非公開または削除されていないか確認してください
- ディスク容量を確認してください

### 動画一覧が取得できない

- ログインが必要です。先にログインを完了してください
- ユーザー名が正しいか確認してください

## 依存ライブラリ

### Python
- [cloudscraper](https://github.com/VeNoMouS/cloudscraper) - Cloudflare対策

### .NET
- Microsoft.Data.Sqlite
- System.Text.Json
- System.Security.Cryptography.ProtectedData

## ライセンス

MIT License - 詳細は [LICENSE](LICENSE) をご覧ください。

## 免責事項

- 本ソフトウェアは個人利用を目的としています
- ダウンロードした動画の著作権は各権利者に帰属します
- 本ソフトウェアの使用により生じたいかなる損害・損失についても、作者は責任を負いません
- iwara.tv の利用規約を遵守してご使用ください

## 謝辞

このプロジェクトは以下のプロジェクトを参考に構築されています：

- [iwara-python-api](https://github.com/xiatg/iwara-python-api)
- [cloudscraper](https://github.com/VeNoMouS/cloudscraper)

また、以下のツールによってコーディングされました：
- [claude.ai](https://claude.ai) Opus 4.5
